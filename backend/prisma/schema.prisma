// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Table Management Model
model Table {
  id          String      @id @default(uuid()) @db.Uuid
  tableNumber String      @unique @map("table_number") @db.VarChar(50)
  capacity    Int         @db.Integer
  location    String?     @db.VarChar(100)
  description String?     @db.Text
  status      TableStatus @default(ACTIVE)
  qrToken     String?     @map("qr_token") @db.VarChar(500)
  createdAt   DateTime    @default(now()) @map("created_at")
  updatedAt   DateTime    @updatedAt @map("updated_at")

  @@index([status])
  @@index([location])
  @@map("tables")
}

enum TableStatus {
  ACTIVE
  INACTIVE
}
enum MenuStatus {
  ACTIVE
  INACTIVE
}

enum CategoryStatus {
  ACTIVE
  INACTIVE
}

enum ItemStatus {
  AVAILABLE
  UNAVAILABLE
  SOLDOUT
}
enum ModifierSelectionType {
  SINGLE
  MULTIPLE
}

model MenuCategory {
  id           String     @id @default(uuid()) @db.Uuid
  restaurantId String     @map("restaurant_id") @db.Uuid
  name         String     @db.VarChar(50)
  description  String?    @db.Text
  displayOrder Int        @default(0) @map("display_order")
  status       MenuStatus @default(ACTIVE)
  createdAt    DateTime   @default(now()) @map("created_at")
  updatedAt    DateTime   @default(now()) @updatedAt @map("updated_at")

  items MenuItem[]

  @@unique([restaurantId, name])
  @@index([restaurantId])
  @@index([status])
  @@map("menu_categories")
}

model MenuItem {
  id                String     @id @default(uuid()) @db.Uuid
  restaurantId      String     @map("restaurant_id") @db.Uuid
  categoryId        String     @map("category_id") @db.Uuid
  name              String     @db.VarChar(80)
  description       String?    @db.Text
  price             Decimal    @db.Decimal(12, 2)
  prepTimeMinutes   Int        @default(0) @map("prep_time_minutes")
  status            ItemStatus @map("status")
  isChefRecommended Boolean    @default(false) @map("is_chef_recommended")
  isDeleted         Boolean    @default(false) @map("is_deleted")
  createdAt         DateTime   @default(now()) @map("created_at")
  updatedAt         DateTime   @default(now()) @updatedAt @map("updated_at")

  category       MenuCategory            @relation(fields: [categoryId], references: [id])
  photos         MenuItemPhoto[]
  modifierGroups MenuItemModifierGroup[]

  @@index([restaurantId])
  @@index([categoryId])
  @@index([status])
  @@map("menu_items")
}

model MenuItemPhoto {
  id         String   @id @default(uuid()) @db.Uuid
  menuItemId String   @map("menu_item_id") @db.Uuid
  url        String
  isPrimary  Boolean  @default(false)
  sortOrder  Int      @default(0)
  createdAt  DateTime @default(now()) @map("created_at")

  menuItem MenuItem @relation(fields: [menuItemId], references: [id], onDelete: Cascade)

  @@index([menuItemId])
  @@map("menu_item_photos")
}

model ModifierGroup {
  id            String                @id @default(uuid()) @db.Uuid
  restaurantId  String                @map("restaurant_id") @db.Uuid
  name          String                @db.VarChar(80)
  selectionType ModifierSelectionType @map("selection_type")
  isRequired    Boolean               @default(false) @map("is_required")
  minSelections Int                   @default(0) @map("min_selections")
  maxSelections Int                   @default(0) @map("max_selections")
  displayOrder  Int                   @default(0) @map("display_order")
  status        MenuStatus            @default(ACTIVE)
  createdAt     DateTime              @default(now()) @map("created_at")
  updatedAt     DateTime              @default(now()) @updatedAt @map("updated_at")

  options   ModifierOption[]
  menuItems MenuItemModifierGroup[]

  @@map("modifier_groups")
}

model ModifierOption {
  id              String     @id @default(uuid()) @db.Uuid
  groupId         String     @map("group_id") @db.Uuid
  name            String     @db.VarChar(80)
  priceAdjustment Decimal    @default(0) @map("price_adjustment") @db.Decimal(12, 2)
  status          MenuStatus @default(ACTIVE)
  createdAt       DateTime   @default(now()) @map("created_at")

  group ModifierGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)

  @@index([groupId])
  @@map("modifier_options")
}

model MenuItemModifierGroup {
  menuItemId String @map("menu_item_id") @db.Uuid
  groupId    String @map("group_id") @db.Uuid

  menuItem MenuItem      @relation(fields: [menuItemId], references: [id], onDelete: Cascade)
  group    ModifierGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)

  @@id([menuItemId, groupId])
  @@map("menu_item_modifier_groups")
}

// User Model for Authentication
model User {
  id        String   @id @default(uuid()) @db.Uuid
  email     String   @unique @db.VarChar(255)
  password  String   @db.VarChar(255)
  name      String?  @db.VarChar(100)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("users")
}
